<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aventura de Palabras: Sin贸nimos y Ant贸nimos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f0f9ff;
        }
        .drop-zone {
            min-height: 80px;
            transition: all 0.3s ease;
        }
        .drag-item {
            cursor: grab;
            transition: transform 0.2s;
        }
        .drag-item:active {
            cursor: grabbing;
            transform: scale(1.05);
        }
        .correct {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
        }
        .incorrect {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce-slow {
            animation: bounce 2s infinite;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-600 mb-2"> Aventura de Palabras</h1>
            <p class="text-gray-600 text-lg">Aprende sin贸nimos y ant贸nimos jugando</p>
        </header>

        <!-- Main Game Area -->
        <main id="game-container" class="bg-white rounded-3xl shadow-xl p-6 mb-8 border-4 border-blue-200">
            <div id="setup-screen" class="text-center py-10">
                <h2 class="text-2xl font-semibold mb-6">驴C贸mo te llamas, aventurero/a?</h2>
                <input type="text" id="user-name" placeholder="Tu nombre aqu铆" class="border-2 border-blue-300 rounded-full px-6 py-3 text-xl focus:outline-none focus:border-blue-500 mb-4">
                <br>
                <button onclick="startGame()" class="bg-yellow-400 hover:bg-yellow-500 text-blue-900 font-bold py-3 px-10 rounded-full text-xl shadow-lg transition transform hover:scale-105">
                    隆Empezar a jugar!
                </button>
            </div>

            <div id="play-screen" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <div class="bg-blue-100 px-4 py-2 rounded-full text-blue-700 font-bold">
                        Puntos: <span id="score-display">0</span>
                    </div>
                    <div class="text-gray-500 font-medium italic">
                        Nivel: <span id="level-display">1</span> / 10
                    </div>
                </div>

                <div class="text-center mb-8">
                    <h2 id="question-text" class="text-2xl font-bold text-gray-800">Cargando desaf铆o...</h2>
                    <p id="instruction-text" class="text-blue-500 font-semibold mt-2">Busca el sin贸nimo de esta palabra</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Target Word -->
                    <div class="flex flex-col items-center justify-center p-6 bg-blue-50 rounded-2xl border-2 border-dashed border-blue-300">
                        <span id="target-word" class="text-4xl font-black text-blue-700 uppercase tracking-wide">...</span>
                    </div>

                    <!-- Drop Zone -->
                    <div id="drop-zone" ondrop="drop(event)" ondragover="allowDrop(event)" class="drop-zone flex items-center justify-center p-6 bg-gray-50 rounded-2xl border-4 border-dotted border-gray-300">
                        <p id="drop-placeholder" class="text-gray-400 italic">Arrastra la respuesta aqu铆</p>
                    </div>
                </div>

                <!-- Options -->
                <div id="options-container" class="flex flex-wrap justify-center gap-4 mt-10">
                    <!-- Options will be injected here -->
                </div>
            </div>
        </main>

        <!-- Stats Section -->
        <section class="bg-white rounded-3xl shadow-lg p-6 border-2 border-gray-100">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-700 mb-4 md:mb-0"> Estad铆sticas de <span id="stats-name">Invitado</span></h3>
                <div class="flex gap-2">
                    <button onclick="exportToCSV()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2">
                         Exportar a CSV
                    </button>
                    <button onclick="resetStats()" class="bg-red-100 hover:bg-red-200 text-red-600 px-4 py-2 rounded-lg text-sm font-bold">
                        Limpiar Datos
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div class="p-4 bg-green-50 rounded-xl">
                    <p class="text-xs text-green-600 uppercase font-bold">Aciertos</p>
                    <p id="total-hits" class="text-2xl font-black text-green-700">0</p>
                </div>
                <div class="p-4 bg-red-50 rounded-xl">
                    <p class="text-xs text-red-600 uppercase font-bold">Errores</p>
                    <p id="total-misses" class="text-2xl font-black text-red-700">0</p>
                </div>
                <div class="p-4 bg-blue-50 rounded-xl">
                    <p class="text-xs text-blue-600 uppercase font-bold">Efectividad</p>
                    <p id="accuracy" class="text-2xl font-black text-blue-700">0%</p>
                </div>
                <div class="p-4 bg-purple-50 rounded-xl">
                    <p class="text-xs text-purple-600 uppercase font-bold">Jugados</p>
                    <p id="total-played" class="text-2xl font-black text-purple-700">0</p>
                </div>
            </div>

            <!-- Detailed Log -->
            <div class="mt-8 overflow-x-auto">
                <table class="w-full text-left">
                    <thead>
                        <tr class="text-gray-400 text-xs uppercase border-b">
                            <th class="pb-2">Fecha</th>
                            <th class="pb-2">Palabra</th>
                            <th class="pb-2">Relaci贸n</th>
                            <th class="pb-2">Resultado</th>
                        </tr>
                    </thead>
                    <tbody id="stats-log-body" class="text-sm text-gray-600">
                        <!-- Log entries injected here -->
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- Feedback Message -->
    <div id="feedback-msg" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 px-8 py-4 rounded-full text-white font-bold shadow-2xl hidden z-50">
        隆Mensaje!
    </div>

    <script>
        // --- Database of Words ---
        const wordBank = [
            { word: "Peque帽o", type: "sinonimo", options: ["Chico", "Grande", "R谩pido"], answer: "Chico" },
            { word: "R谩pido", type: "ant贸nimo", options: ["Lento", "Veloz", "Saltarin"], answer: "Lento" },
            { word: "Feliz", type: "sinonimo", options: ["Contento", "Triste", "Enojado"], answer: "Contento" },
            { word: "Alto", type: "ant贸nimo", options: ["Bajo", "Grande", "Largo"], answer: "Bajo" },
            { word: "Bonito", type: "sinonimo", options: ["Hermoso", "Feo", "Sucio"], answer: "Hermoso" },
            { word: "Cerrar", type: "ant贸nimo", options: ["Abrir", "Tirar", "Empujar"], answer: "Abrir" },
            { word: "Gritar", type: "sinonimo", options: ["Vocear", "Callar", "Susurrar"], answer: "Vocear" },
            { word: "Caliente", type: "ant贸nimo", options: ["Fr铆o", "Tibio", "Fuego"], answer: "Fr铆o" },
            { word: "Comenzar", type: "sinonimo", options: ["Empezar", "Acabar", "Pausar"], answer: "Empezar" },
            { word: "Luz", type: "ant贸nimo", options: ["Oscuridad", "Brillo", "Sol"], answer: "Oscuridad" }
        ];

        let gameState = {
            userName: "",
            currentLevel: 0,
            score: 0,
            history: JSON.parse(localStorage.getItem('eduGameHistory')) || []
        };

        // --- Initialization ---
        window.onload = () => {
            updateStatsUI();
        };

        function startGame() {
            const nameInput = document.getElementById('user-name').value.trim();
            if (!nameInput) {
                showFeedback("Por favor, dinos tu nombre", "bg-red-500");
                return;
            }
            gameState.userName = nameInput;
            gameState.currentLevel = 0;
            gameState.score = 0;
            
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('play-screen').classList.remove('hidden');
            document.getElementById('stats-name').innerText = nameInput;
            
            loadLevel();
        }

        // --- Game Logic ---
        function loadLevel() {
            if (gameState.currentLevel >= wordBank.length) {
                showFeedback("隆Felicidades! Completaste todos los niveles.", "bg-purple-600");
                gameState.currentLevel = 0; // Reiniciar o mostrar pantalla final
            }

            const levelData = wordBank[gameState.currentLevel];
            document.getElementById('level-display').innerText = gameState.currentLevel + 1;
            document.getElementById('score-display').innerText = gameState.score;
            document.getElementById('target-word').innerText = levelData.word;
            document.getElementById('instruction-text').innerText = `Busca el ${levelData.type} de esta palabra`;
            
            // Clear drop zone
            const dropZone = document.getElementById('drop-zone');
            dropZone.innerHTML = '<p id="drop-placeholder" class="text-gray-400 italic">Arrastra la respuesta aqu铆</p>';
            dropZone.className = "drop-zone flex items-center justify-center p-6 bg-gray-50 rounded-2xl border-4 border-dotted border-gray-300";

            // Render options
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            // Shuffle options
            const shuffledOptions = [...levelData.options].sort(() => Math.random() - 0.5);
            
            shuffledOptions.forEach(opt => {
                const btn = document.createElement('div');
                btn.className = "drag-item bg-white border-2 border-blue-400 text-blue-600 font-bold px-6 py-3 rounded-xl shadow-md";
                btn.innerText = opt;
                btn.draggable = true;
                btn.id = "opt-" + Math.random().toString(36).substr(2, 9);
                btn.ondragstart = drag;
                container.appendChild(btn);
            });
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }

        function drop(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            const draggedEl = document.getElementById(data);
            const dropZone = document.getElementById('drop-zone');
            const placeholder = document.getElementById('drop-placeholder');
            
            if(placeholder) placeholder.remove();
            
            // Solo una respuesta por turno
            if(dropZone.children.length > 0 && !placeholder) return;

            dropZone.appendChild(draggedEl);
            validateAnswer(draggedEl.innerText);
        }

        function validateAnswer(selectedWord) {
            const currentLevelData = wordBank[gameState.currentLevel];
            const isCorrect = selectedWord.toLowerCase() === currentLevelData.answer.toLowerCase();
            const dropZone = document.getElementById('drop-zone');

            // Log event
            const logEntry = {
                user: gameState.userName,
                date: new Date().toLocaleString(),
                word: currentLevelData.word,
                type: currentLevelData.type,
                response: selectedWord,
                correct: isCorrect
            };
            gameState.history.push(logEntry);
            localStorage.setItem('eduGameHistory', JSON.stringify(gameState.history));

            if (isCorrect) {
                gameState.score += 10;
                dropZone.classList.add('correct');
                showFeedback("隆Excelente! ", "bg-green-500");
                setTimeout(() => {
                    gameState.currentLevel++;
                    loadLevel();
                    updateStatsUI();
                }, 1500);
            } else {
                gameState.score = Math.max(0, gameState.score - 5);
                dropZone.classList.add('incorrect');
                showFeedback("隆Ups! Int茅ntalo de nuevo", "bg-red-500");
                setTimeout(() => {
                    loadLevel(); // Reiniciar el nivel actual
                    updateStatsUI();
                }, 1500);
            }
        }

        function showFeedback(msg, colorClass) {
            const el = document.getElementById('feedback-msg');
            el.innerText = msg;
            el.className = `fixed bottom-10 left-1/2 transform -translate-x-1/2 px-8 py-4 rounded-full text-white font-bold shadow-2xl z-50 ${colorClass}`;
            el.classList.remove('hidden');
            setTimeout(() => el.classList.add('hidden'), 2000);
        }

        // --- Stats & Export ---
        function updateStatsUI() {
            const history = gameState.history;
            const total = history.length;
            const hits = history.filter(h => h.correct).length;
            const misses = total - hits;
            const acc = total > 0 ? Math.round((hits / total) * 100) : 0;

            document.getElementById('total-hits').innerText = hits;
            document.getElementById('total-misses').innerText = misses;
            document.getElementById('accuracy').innerText = acc + "%";
            document.getElementById('total-played').innerText = total;

            const tbody = document.getElementById('stats-log-body');
            tbody.innerHTML = '';
            
            // Mostrar 煤ltimos 5 eventos
            [...history].reverse().slice(0, 5).forEach(h => {
                const row = `
                    <tr class="border-b last:border-0">
                        <td class="py-2">${h.date.split(',')[0]}</td>
                        <td class="py-2 font-bold">${h.word}</td>
                        <td class="py-2 capitalize text-xs">${h.type}</td>
                        <td class="py-2">
                            <span class="px-2 py-1 rounded text-xs ${h.correct ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                                ${h.correct ? 'Acierto' : 'Fallo'}
                            </span>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function resetStats() {
            if(confirm("驴Est谩s seguro de que quieres borrar todo el progreso?")) {
                gameState.history = [];
                localStorage.removeItem('eduGameHistory');
                updateStatsUI();
            }
        }

        function exportToCSV() {
            if (gameState.history.length === 0) {
                showFeedback("No hay datos para exportar", "bg-yellow-500");
                return;
            }

            const headers = ["Usuario", "Fecha", "Palabra Base", "Relaci贸n", "Respuesta Alumno", "Resultado"];
            const rows = gameState.history.map(h => [
                h.user,
                h.date,
                h.word,
                h.type,
                h.response,
                h.correct ? "Acierto" : "Fallo"
            ]);

            let csvContent = "data:text/csv;charset=utf-8," 
                + headers.join(",") + "\n"
                + rows.map(e => e.join(",")).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `progreso_lengua_${gameState.userName || 'estudiante'}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
